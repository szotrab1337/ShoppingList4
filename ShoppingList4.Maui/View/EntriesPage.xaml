<?xml version="1.0" encoding="utf-8" ?>

<ContentPage
    x:Class="ShoppingList4.Maui.View.EntriesPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewModel="clr-namespace:ShoppingList4.Maui.ViewModel"
    xmlns:entities="clr-namespace:ShoppingList4.Maui.ViewModel.Entities"
    xmlns:dxcv="clr-namespace:DevExpress.Maui.CollectionView;assembly=DevExpress.Maui.CollectionView"
    xmlns:dxe="clr-namespace:DevExpress.Maui.Editors;assembly=DevExpress.Maui.Editors"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    Title="Lista zakupów"
    x:DataType="viewModel:EntriesViewModel"
    BackgroundColor="{DynamicResource Gray950}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <toolkit:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.ToolbarItems>
        <ToolbarItem
            Text="Usuń wszystko"
            Command="{Binding Path=BindingContext.DeleteAllCommand, Source={RelativeSource AncestorType={x:Type Page}}}"
            Order="Secondary" />
        <ToolbarItem
            Text="Usuń kupione"
            Command="{Binding Path=BindingContext.DeleteBoughtCommand, Source={RelativeSource AncestorType={x:Type Page}}}"
            Order="Secondary" />
    </ContentPage.ToolbarItems>

    <AbsoluteLayout>

        <Grid
            Margin="5,10,5,10"
            AbsoluteLayout.LayoutFlags="All"
            AbsoluteLayout.LayoutBounds="0,0,1,1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Label
                Grid.Row="0"
                Grid.RowSpan="2"
                Text="Brak przedmiotów do kupienia!"
                FontSize="20"
                TextColor="#616161"
                HorizontalOptions="CenterAndExpand"
                VerticalOptions="CenterAndExpand"
                HorizontalTextAlignment="Center">
                <Label.Style>
                    <Style TargetType="Label">
                        <Setter Property="IsVisible" Value="False" />
                        <Style.Triggers>
                            <DataTrigger
                                TargetType="Label"
                                Binding="{Binding Entries.Count}"
                                Value="0">
                                <Setter Property="IsVisible" Value="True" />
                            </DataTrigger>
                            <DataTrigger
                                TargetType="Label"
                                Binding="{Binding IsInitializing}"
                                Value="True">
                                <Setter Property="IsVisible" Value="False" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Label.Style>
            </Label>

            <Border
                Grid.Row="0"
                Grid.RowSpan="2"
                BackgroundColor="{DynamicResource Gray900}"
                WidthRequest="150"
                Stroke="Transparent"
                HeightRequest="120"
                StrokeShape="RoundRectangle 10"
                IsVisible="{Binding IsInitializing}">
                <Grid HorizontalOptions="CenterAndExpand">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <ActivityIndicator
                        Margin="0,20,0,0"
                        WidthRequest="70"
                        IsRunning="{Binding IsInitializing}" />
                    <Label
                        Grid.Row="1"
                        Margin="0,10,0,0"
                        Text="Ładowanie...."
                        HorizontalOptions="Center" />
                </Grid>
            </Border>


            <dxe:FilterChipGroup
                Grid.Row="0"
                Padding="5,5,5,10"
                ItemsSource="{Binding FilterItems}"
                SelectedItems="{Binding SelectedFilterItems, Mode=TwoWay}"
                IsMultiline="True"
                DisplayMember="DisplayText" />

            <RefreshView
                Grid.Row="1"
                IsRefreshing="{Binding IsRefreshing}"
                Command="{Binding Path=BindingContext.RefreshCommand, Source={RelativeSource AncestorType={x:Type Page}}}"
                IsVisible="{Binding IsInitializing, Converter={StaticResource InvertedBoolConverter}}">

                <dxcv:DXCollectionView
                    ItemsSource="{Binding Entries}"
                    FilterString="{Binding Filter, Mode=TwoWay}">
                    <dxcv:DXCollectionView.ItemTemplate>
                        <DataTemplate x:DataType="entities:EntryViewModel">

                            <dxcv:SwipeContainer FullSwipeMode="None">
                                <dxcv:SwipeContainer.ItemView>
                                    <StackLayout Margin="0,0,0,3">
                                        <Border
                                            Padding="0"
                                            Stroke="Transparent"
                                            StrokeShape="RoundRectangle 10"
                                            BackgroundColor="{DynamicResource Gray900}">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <DataTrigger
                                                            Binding="{Binding IsBought}"
                                                            TargetType="Border"
                                                            Value="True">
                                                            <Setter Property="BackgroundColor" Value="{DynamicResource Gray950}" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>

                                            <StackLayout
                                                Margin="8"
                                                Orientation="Horizontal">

                                                <CheckBox
                                                    IsChecked="{Binding IsBought}"
                                                    HorizontalOptions="Center"
                                                    VerticalOptions="Center"
                                                    HeightRequest="35"
                                                    WidthRequest="40">
                                                    <CheckBox.Style>
                                                        <Style TargetType="CheckBox">
                                                            <Style.Triggers>
                                                                <Trigger TargetType="CheckBox" Property="IsChecked" Value="True">
                                                                    <Setter Property="Color" Value="{DynamicResource Gray400}" />
                                                                </Trigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </CheckBox.Style>
                                                </CheckBox>

                                                <Label
                                                    Margin="0,5,0,5"
                                                    Text="{Binding Name}"
                                                    FontSize="20"
                                                    TextColor="{DynamicResource Gray100}"
                                                    VerticalOptions="CenterAndExpand">
                                                    <Label.Style>
                                                        <Style TargetType="Label">
                                                            <Style.Triggers>
                                                                <DataTrigger
                                                                    Binding="{Binding IsBought}"
                                                                    TargetType="Label"
                                                                    Value="True">
                                                                    <Setter Property="TextColor" Value="{DynamicResource Gray400}" />
                                                                    <Setter Property="TextDecorations" Value="Strikethrough" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Label.Style>
                                                </Label>

                                            </StackLayout>
                                        </Border>
                                    </StackLayout>
                                </dxcv:SwipeContainer.ItemView>

                                <dxcv:SwipeContainer.EndSwipeItems>
                                    <dxcv:SwipeContainerItem
                                        BackgroundColor="{DynamicResource Gray950}"
                                        Caption="Usuń"
                                        Command="{Binding Path=BindingContext.DeleteCommand, Source={RelativeSource AncestorType={x:Type Page}}}"
                                        CommandParameter="{Binding .}"
                                        FontColor="{DynamicResource Gray100}" />
                                    <dxcv:SwipeContainerItem
                                        BackgroundColor="{DynamicResource Gray950}"
                                        Caption="Edytuj"
                                        Command="{Binding Path=BindingContext.EditCommand, Source={RelativeSource AncestorType={x:Type Page}}}"
                                        CommandParameter="{Binding .}"
                                        FontColor="{DynamicResource Gray100}" />
                                </dxcv:SwipeContainer.EndSwipeItems>
                            </dxcv:SwipeContainer>

                        </DataTemplate>
                    </dxcv:DXCollectionView.ItemTemplate>
                </dxcv:DXCollectionView>

            </RefreshView>
        </Grid>

        <Border
            Padding="0"
            Stroke="Transparent"
            StrokeShape="RoundRectangle 75"
            BackgroundColor="{DynamicResource Primary}"
            HeightRequest="60"
            WidthRequest="60"
            HorizontalOptions="Center"
            VerticalOptions="Center"
            AbsoluteLayout.LayoutBounds=".95,.95,60,60"
            AbsoluteLayout.LayoutFlags="PositionProportional">
            <Button
                Text="+"
                Command="{Binding AddCommand}"
                FontSize="25" />
        </Border>

    </AbsoluteLayout>
</ContentPage>